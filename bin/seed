import os, sys
from giraffe import available
from giraffe import ingested
from giraffe import docstore
from giraffe import cfg
from itertools import islice

data = available.updates(host=cfg.get('ard')['URL'], limit=int(1e7),
                        **dict(username=cfg.get('ard')['USER'],
                                password=cfg.get('ard')['PASS']))

i = 0
while True:
    d = list(islice(data, i, i+1))[0] # Grab a single chunk via HTTP
    docstore.index(host=cfg.get('ard')['ES_HOST'],
                    index=cfg.get('ard')['ES_INDEX'],
                    data=d)
    i+=1

    docstore.index(host=cfg.get('iwds')['ES_HOST'],
                    index=cfg.get('iwds')['ES_INDEX'],
                    data=ingested.updates(host=cfg.get('iwds')['URL'],
                    tiles=d))

